'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.diff_stack_list = diff_stack_list;
exports.as_stack_filter = as_stack_filter;
exports.diff_frame_lines = diff_frame_lines;
class Traceback {
  constructor(trace_tip, asFrameList) {
    this.trace_tip = trace_tip;
    this.asFrameList = asFrameList;
  }

  async_stack() {
    return this.toString();
  }

  toString(lead = '') {
    const { tail, head } = this.toLines();
    const lines = head.length ? [lead].concat(tail, ['    ...'], head) : [lead].concat(tail);
    return lines.join('\n');
  }

  toLines(limit) {
    return this.toFrames(limit, flatten);
  }

  toFrames(limit, xform) {
    if (!xform) {
      xform = v => v;
    }
    const err_frames = this.toErrorFrames(limit);
    const head = xform(diff_stack_list(err_frames.head, this.stack_filter));
    const tail = xform(diff_stack_list(err_frames.tail, this.stack_filter));
    return { tail, head };
  }

  toErrorFrames(limit) {
    if (undefined === limit) {
      limit = this.default_limit;
    }
    const tip = this.trace_tip;
    const head = tip.early;
    const tail = this.asFrameList(tip, limit);
    const idx = head ? tail.indexOf(head[0]) : -1;
    if (-1 < idx) {
      tail.splice(idx, tail.length, ...head.splice(0, head.length));
    }
    return { tail, head };
  }
}exports.Traceback = Traceback;


Traceback.prototype.default_limit = 10;
Traceback.prototype.stack_filter = as_stack_filter(new Set(['bootstrap_node', 'AsyncHook.init'].concat(Object.keys(process.binding('natives')))));function diff_stack_list(error_frames, stack_filter, asRawFrames) {
  if (!error_frames || !error_frames.length) {
    return [];
  }

  if ('function' !== typeof stack_filter) {
    stack_filter = as_stack_filter(stack_filter);
  }

  const frames = error_frames.map(err => ({
    key: err.message, lines: err.stack.split(/\r?\n/).filter(stack_filter) }));

  frames.reduce((cur, prev) => {
    cur.lines = diff_frame_lines(cur.lines, prev.lines);
    return prev;
  });

  if (asRawFrames) {
    return frames;
  } else {
    return frames.map(frame => [`    -- ${frame.key}`].concat(frame.lines));
  }
}const rx_stack_at = exports.rx_stack_at = /\s+at\s(.*)\s+\((.*)\)$/;
function as_stack_filter(suppress) {
  if (!suppress) {
    return line => rx_stack_at.exec(line);
  }

  if ('function' !== typeof suppress.has) {
    throw new TypeError(`Expected set-like suppress instance`);
  }

  return line => {
    const m = rx_stack_at.exec(line);
    if (!m) {
      return;
    }
    if (suppress.has(m[1]) || suppress.has(m[2])) {
      return;
    }
    const basename = m[2].split('.')[0];
    if (suppress.has(basename)) {
      return;
    }
    return true;
  };
}function diff_frame_lines(cur_lines, prev_lines) {
  let i0 = cur_lines.length - 1;
  let i1 = prev_lines.lastIndexOf(cur_lines[i0]);

  // match from the tail of cur_lines and walk backward until difference is found
  if (-1 === i1) {
    return cur_lines;
  }
  while (i0 >= 0 && i1 >= 0 && cur_lines[i0] === prev_lines[i1]) {
    i0--;i1--;
  }

  return cur_lines.slice(0, i0 + 1);
}

function flatten(lst) {
  return lst.reduce((a, b) => a.concat(b), []);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2NvZGUvdHJhY2ViYWNrLmpzeSJdLCJuYW1lcyI6WyJkaWZmX3N0YWNrX2xpc3QiLCJhc19zdGFja19maWx0ZXIiLCJkaWZmX2ZyYW1lX2xpbmVzIiwiVHJhY2ViYWNrIiwiY29uc3RydWN0b3IiLCJ0cmFjZV90aXAiLCJhc0ZyYW1lTGlzdCIsImFzeW5jX3N0YWNrIiwidG9TdHJpbmciLCJsZWFkIiwidGFpbCIsImhlYWQiLCJ0b0xpbmVzIiwibGluZXMiLCJsZW5ndGgiLCJjb25jYXQiLCJqb2luIiwibGltaXQiLCJ0b0ZyYW1lcyIsImZsYXR0ZW4iLCJ4Zm9ybSIsInYiLCJlcnJfZnJhbWVzIiwidG9FcnJvckZyYW1lcyIsInN0YWNrX2ZpbHRlciIsInVuZGVmaW5lZCIsImRlZmF1bHRfbGltaXQiLCJ0aXAiLCJlYXJseSIsImlkeCIsImluZGV4T2YiLCJzcGxpY2UiLCJwcm90b3R5cGUiLCJTZXQiLCJPYmplY3QiLCJrZXlzIiwicHJvY2VzcyIsImJpbmRpbmciLCJlcnJvcl9mcmFtZXMiLCJhc1Jhd0ZyYW1lcyIsImZyYW1lcyIsIm1hcCIsImVyciIsImtleSIsIm1lc3NhZ2UiLCJzdGFjayIsInNwbGl0IiwiZmlsdGVyIiwicmVkdWNlIiwiY3VyIiwicHJldiIsImZyYW1lIiwicnhfc3RhY2tfYXQiLCJzdXBwcmVzcyIsImxpbmUiLCJleGVjIiwiaGFzIiwiVHlwZUVycm9yIiwibSIsImJhc2VuYW1lIiwiY3VyX2xpbmVzIiwicHJldl9saW5lcyIsImkwIiwiaTEiLCJsYXN0SW5kZXhPZiIsInNsaWNlIiwibHN0IiwiYSIsImIiXSwibWFwcGluZ3MiOiI7Ozs7O1FBMENnQkEsZSxHQUFBQSxlO1FBc0JBQyxlLEdBQUFBLGU7UUFlQUMsZ0IsR0FBQUEsZ0I7QUE5RVQsTUFBTUMsU0FBTixDQUFnQjtBQUNyQkMsY0FBWUMsU0FBWixFQUF1QkMsV0FBdkIsRUFBb0M7QUFDbEMsU0FBS0QsU0FBTCxHQUFpQkEsU0FBakI7QUFDQSxTQUFLQyxXQUFM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R0FBVCxDQUFhRyxRQUFiLENBQUgsRUFBNEI7QUFBQztBQUFNO0FBQ25DLFdBQU8sSUFBUDtBQUFXLEdBTmI7QUFNYSxDQUVSLFNBQVN6RCxnQkFBVCxDQUEwQjBELFNBQTFCLEVBQXFDQyxVQUFyQyxFQUFpRDtBQUN0RCxNQUFJQyxLQUFLRixVQUFVOUMsTUFBVixHQUFtQixDQUE1QjtBQUNBLE1BQUlpRCxLQUFLRixXQUFXRyxXQUFYLENBQXVCSixVQUFVRSxFQUFWLENBQXZCLENBQVQ7O0FBRUE7QUFDQSxNQUFHLENBQUMsQ0FBRCxLQUFPQyxFQUFWLEVBQWU7QUFBQyxXQUFPSCxTQUFQO0FBQWdCO0FBQ2hDLFNBQU1FLE1BQU0sQ0FBTixJQUFXQyxNQUFNLENBQWpCLElBQXNCSCxVQUFVRSxFQUFWLE1BQWtCRCxXQUFXRSxFQUFYLENBQTlDLEVBQStEO0FBQzdERCxTQUFNQztBQUFJOztBQUVaLFNBQU9ILFVBQVVLLEtBQVYsQ0FBZ0IsQ0FBaEIsRUFBbUJILEtBQUcsQ0FBdEIsQ0FBUDtBQUErQjs7QUFFakMsU0FBUzNDLE9BQVQsQ0FBaUIrQyxHQUFqQixFQUFzQjtBQUFHLFNBQU9BLElBQUlsQixNQUFKLENBQWEsQ0FBQ21CLENBQUQsRUFBR0MsQ0FBSCxLQUFTRCxFQUFFcEQsTUFBRixDQUFTcUQsQ0FBVCxDQUF0QixFQUFtQyxFQUFuQyxDQUFQO0FBQTRDIiwiZmlsZSI6InRyYWNlYmFjay5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuZXhwb3J0IGNsYXNzIFRyYWNlYmFjayA6OlxuICBjb25zdHJ1Y3Rvcih0cmFjZV90aXAsIGFzRnJhbWVMaXN0KSA6OlxuICAgIHRoaXMudHJhY2VfdGlwID0gdHJhY2VfdGlwXG4gICAgdGhpcy5hc0ZyYW1lTGlzdCA9IGFzRnJhbWVMaXN0XG5cbiAgYXN5bmNfc3RhY2soKSA6OiByZXR1cm4gdGhpcy50b1N0cmluZygpXG5cbiAgdG9TdHJpbmcobGVhZD0nJykgOjpcbiAgICBjb25zdCB7dGFpbCwgaGVhZH0gPSB0aGlzLnRvTGluZXMoKVxuICAgIGNvbnN0IGxpbmVzID0gaGVhZC5sZW5ndGhcbiAgICAgID8gW2xlYWRdLmNvbmNhdCBAIHRhaWwsIFsnICAgIC4uLiddLCBoZWFkXG4gICAgICA6IFtsZWFkXS5jb25jYXQgQCB0YWlsXG4gICAgcmV0dXJuIGxpbmVzLmpvaW4oJ1xcbicpXG5cbiAgdG9MaW5lcyhsaW1pdCkgOjpcbiAgICByZXR1cm4gdGhpcy50b0ZyYW1lcyhsaW1pdCwgZmxhdHRlbilcblxuICB0b0ZyYW1lcyhsaW1pdCwgeGZvcm0pIDo6XG4gICAgaWYgISB4Zm9ybSA6OiB4Zm9ybSA9IHYgPT4gdlxuICAgIGNvbnN0IGVycl9mcmFtZXMgPSB0aGlzLnRvRXJyb3JGcmFtZXMobGltaXQpXG4gICAgY29uc3QgaGVhZCA9IHhmb3JtIEAgZGlmZl9zdGFja19saXN0KGVycl9mcmFtZXMuaGVhZCwgdGhpcy5zdGFja19maWx0ZXIpXG4gICAgY29uc3QgdGFpbCA9IHhmb3JtIEAgZGlmZl9zdGFja19saXN0KGVycl9mcmFtZXMudGFpbCwgdGhpcy5zdGFja19maWx0ZXIpXG4gICAgcmV0dXJuIEB7fSB0YWlsLCBoZWFkXG5cbiAgdG9FcnJvckZyYW1lcyhsaW1pdCkgOjpcbiAgICBpZiB1bmRlZmluZWQgPT09IGxpbWl0IDo6IGxpbWl0ID0gdGhpcy5kZWZhdWx0X2xpbWl0XG4gICAgY29uc3QgdGlwID0gdGhpcy50cmFjZV90aXBcbiAgICBjb25zdCBoZWFkID0gdGlwLmVhcmx5XG4gICAgY29uc3QgdGFpbCA9IHRoaXMuYXNGcmFtZUxpc3QodGlwLCBsaW1pdClcbiAgICBjb25zdCBpZHggPSBoZWFkID8gdGFpbC5pbmRleE9mKGhlYWRbMF0pIDogLTFcbiAgICBpZiAtMSA8IGlkeCA6OlxuICAgICAgdGFpbC5zcGxpY2UgQCBpZHgsIHRhaWwubGVuZ3RoLFxuICAgICAgICAuLi4gaGVhZC5zcGxpY2UoMCwgaGVhZC5sZW5ndGgpXG4gICAgcmV0dXJuIEB7fSB0YWlsLCBoZWFkXG5cblRyYWNlYmFjay5wcm90b3R5cGUuZGVmYXVsdF9saW1pdCA9IDEwXG5UcmFjZWJhY2sucHJvdG90eXBlLnN0YWNrX2ZpbHRlciA9IGFzX3N0YWNrX2ZpbHRlciBAIG5ldyBTZXQgQFxuICBbJ2Jvb3RzdHJhcF9ub2RlJywgJ0FzeW5jSG9vay5pbml0J10uY29uY2F0IEBcbiAgICBPYmplY3Qua2V5cyhwcm9jZXNzLmJpbmRpbmcoJ25hdGl2ZXMnKSlcblxuXG5leHBvcnQgZnVuY3Rpb24gZGlmZl9zdGFja19saXN0KGVycm9yX2ZyYW1lcywgc3RhY2tfZmlsdGVyLCBhc1Jhd0ZyYW1lcykgOjpcbiAgaWYgISBlcnJvcl9mcmFtZXMgfHwgISBlcnJvcl9mcmFtZXMubGVuZ3RoIDo6XG4gICAgcmV0dXJuIFtdXG5cbiAgaWYgJ2Z1bmN0aW9uJyAhPT0gdHlwZW9mIHN0YWNrX2ZpbHRlciA6OlxuICAgIHN0YWNrX2ZpbHRlciA9IGFzX3N0YWNrX2ZpbHRlcihzdGFja19maWx0ZXIpXG5cbiAgY29uc3QgZnJhbWVzID0gZXJyb3JfZnJhbWVzLm1hcCBAIGVyciA9PiBAOlxuICAgIGtleTogZXJyLm1lc3NhZ2UsIGxpbmVzOiBlcnIuc3RhY2suc3BsaXQoL1xccj9cXG4vKS5maWx0ZXIoc3RhY2tfZmlsdGVyKVxuXG4gIGZyYW1lcy5yZWR1Y2UgQCAoY3VyLCBwcmV2KSA9PiA6OlxuICAgIGN1ci5saW5lcyA9IGRpZmZfZnJhbWVfbGluZXMgQCBjdXIubGluZXMsIHByZXYubGluZXNcbiAgICByZXR1cm4gcHJldlxuXG4gIGlmIGFzUmF3RnJhbWVzIDo6XG4gICAgcmV0dXJuIGZyYW1lc1xuICBlbHNlIDo6XG4gICAgcmV0dXJuIGZyYW1lcy5tYXAgQCBmcmFtZSA9PlxuICAgICAgW2AgICAgLS0gJHtmcmFtZS5rZXl9YF1cbiAgICAgICAgLmNvbmNhdCBAIGZyYW1lLmxpbmVzXG5cbmV4cG9ydCBjb25zdCByeF9zdGFja19hdCA9IC9cXHMrYXRcXHMoLiopXFxzK1xcKCguKilcXCkkL1xuZXhwb3J0IGZ1bmN0aW9uIGFzX3N0YWNrX2ZpbHRlcihzdXBwcmVzcykgOjpcbiAgaWYgISBzdXBwcmVzcyA6OlxuICAgIHJldHVybiBsaW5lID0+IHJ4X3N0YWNrX2F0LmV4ZWMobGluZSlcblxuICBpZiAnZnVuY3Rpb24nICE9PSB0eXBlb2Ygc3VwcHJlc3MuaGFzIDo6XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvciBAIGBFeHBlY3RlZCBzZXQtbGlrZSBzdXBwcmVzcyBpbnN0YW5jZWBcblxuICByZXR1cm4gbGluZSA9PiA6OlxuICAgIGNvbnN0IG0gPSByeF9zdGFja19hdC5leGVjKGxpbmUpXG4gICAgaWYgISBtIDo6IHJldHVyblxuICAgIGlmIHN1cHByZXNzLmhhcyhtWzFdKSB8fCBzdXBwcmVzcy5oYXMobVsyXSkgOjogcmV0dXJuXG4gICAgY29uc3QgYmFzZW5hbWUgPSBtWzJdLnNwbGl0KCcuJylbMF1cbiAgICBpZiBzdXBwcmVzcy5oYXMoYmFzZW5hbWUpIDo6IHJldHVyblxuICAgIHJldHVybiB0cnVlXG5cbmV4cG9ydCBmdW5jdGlvbiBkaWZmX2ZyYW1lX2xpbmVzKGN1cl9saW5lcywgcHJldl9saW5lcykgOjpcbiAgbGV0IGkwID0gY3VyX2xpbmVzLmxlbmd0aCAtIDFcbiAgbGV0IGkxID0gcHJldl9saW5lcy5sYXN0SW5kZXhPZihjdXJfbGluZXNbaTBdKVxuXG4gIC8vIG1hdGNoIGZyb20gdGhlIHRhaWwgb2YgY3VyX2xpbmVzIGFuZCB3YWxrIGJhY2t3YXJkIHVudGlsIGRpZmZlcmVuY2UgaXMgZm91bmRcbiAgaWYgLTEgPT09IGkxIDo6IHJldHVybiBjdXJfbGluZXNcbiAgd2hpbGUgaTAgPj0gMCAmJiBpMSA+PSAwICYmIGN1cl9saW5lc1tpMF0gPT09IHByZXZfbGluZXNbaTFdIDo6XG4gICAgaTAtLTsgaTEtLVxuXG4gIHJldHVybiBjdXJfbGluZXMuc2xpY2UoMCwgaTArMSlcblxuZnVuY3Rpb24gZmxhdHRlbihsc3QpIDo6IHJldHVybiBsc3QucmVkdWNlIEAgKGEsYikgPT4gYS5jb25jYXQoYiksIFtdXG5cbiJdfQ==